{"version":3,"sources":["assets/scripts/GameProvider.js"],"names":["String","prototype","inArray","arr","console","log","i","k","length","Array","removeByValue","val","splice","minus","result","obj","j","push","socketProvider","require","cc","Class","properties","hideDragItem","innerId","putSele","destroy","createBuff","buff","myBuff","px","py","canvasNode","node","parent","typeId","playSnd","instantiate","playerPrefab","dispCharSele","clickSele","mypos","x","y","moveTo","v2","setPosition","addChild","createAgents","agents","aid","myAgent","agent","agentNode","eo","npcInfo","objectForKey","role","name","type","active","size","level","getComponentByRole","init","setId","setShadow","shadowForAgent","setTotalLife","life","setBlood","bloodForAgent","mainPlayer","rot","updatePos","setObject","createBullets","bullets","myBullet","bullet","eDis","startPos","enemeyDistance","targetpos","targetDis","updown","zIndex","bulletRot","angle","createBases","bases","baseName","baseNode","objectId","baseObj","getChildByName","getComponent","setLife","createLogs","logs","shadowForLog","move","createForts","forts","zorder","spName","parseInt","setZIndex","agentProcess","remoteAgents","localAgents","killAgents","agentObj","agentId","allKeys","remove","removedNpcInfo","removeObjectForKey","baseProcess","remoteBases","killBases","enemyBases","warriorName","warriorObj","_defaultBases","dispLayoutMask","removeChild","playEffect","plusBaseKillNum","enemynum","mynum","string","dir","bd","undisplayMask","sel","killEnemyBases","_self","showMask","showDragMask","ifNotMaskRole","maskType","unshowDragMask","delay","scheduleOnce","putErrorMsg","undisplayPutErr","fortProcess","fortsFuture","logProcess","bulletProcess","remoteBullets","localBullets","killBullets","startSceneJitter","sceneNode","ox","oy","cnt","lower","upper","callBack","randomX","Math","floor","random","randomY","stopAllActions","del","delayTime","cal","callFunc","seq","sequence","runAction","repeatForever","playBases","kingNode","kingArrow","warrior","actType","attackDura","now","tmpB","eoDead","playBaseWarriorAnimationDefault","playBaseWarriorAnimation","playAgents","agentsFuture","playAni","getFutureAgent","setGroupKill","groupKill","round","playForts","playFortWarriorAnimationDefault","isHero","playLogs","sc","playBullets","getFireBombScale","scaleX","scaleY","bulletPos","targetPos","xDif","yDif","midPos","dis","sqrt","ex","ey","getKilledEnemies","aids","killedEnemies","bloodObj","bloodOp","setBarLevel","shadowObj","sacleY","setClickItem","select","putClickItem","selCard","pt","putNode","nick","Number","Date","setDragItem","params","card","target","dragNode","actvie","draggingItem","unsetDragItem","moveDragItem","delta","clearDragItem","param","_name","layoutPt","position","yOffset","magicCost","isValidPutPoint","sendSodier","bar","juice","cost","useMagic","width","MY_SOCKET","json","emit","roomId","setMagicBar","addJuice","magicAmount","updateCardStatus","amount","afterUse","head","nodeName","selNode","selSprite","color","Color"],"mappings":"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","sourceRoot":"/","sourcesContent":["// 定义一个判断函数\nString.prototype.inArray = function(arr){\n        // 不是数组则抛出异常\n    if(!arr){\n        console.log(\"ERR(in_array):Input is not an array\");\n    }\n    // 遍历是否在数组中\n    for(var i=0,k=arr.length;i<k;i++){\n        if(this==arr[i]) {\n            return true;\n        }\n    }\n    // 如果不在数组中就会返回false\n    return false;\n};\n\nArray.prototype.removeByValue = function(val) {\n    for(var i=0;i<this.length;i++) {\n        if(this[i] == val) {\n            this.splice(i, 1);\n            break;\n        }\n    }\n};\n\nArray.prototype.minus = function (arr) {\n    var result = new Array();\n    var obj = {};\n    for (var i = 0; i < arr.length; i++) {\n        obj[arr[i]] = 1;\n    }\n    for (var j = 0; j < this.length; j++) {\n        if (!obj[this[j]])\n        {\n            obj[this[j]] = 1;\n            result.push(this[j]);\n        }\n    }\n    return result;\n};\n\nvar socketProvider = require(\"SocketProvider\");\n\ncc.Class({\n    extends: socketProvider,\n\n    properties: {\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n\n    // onLoad () {},\n\n    // start () {},\n\n    hideDragItem:function (innerId) {\n        if(this.putSele[innerId]) {\n            this.putSele[innerId].destroy();\n            this.putSele[innerId] = null;\n        }\n    },\n\n    createBuff:function(buff) {\n        var myBuff,px,py;\n        var canvasNode = this.node.parent;\n\n        if(buff.typeId == 1) {\n            this.playSnd(\"thunder\");\n            myBuff = cc.instantiate(this.playerPrefab[23]);\n            //canvasNode.getChildByName(\"buffThunder\").active = false;\n        }\n        else if(buff.typeId == 2) {\n            this.playSnd(\"heal\");\n            myBuff = cc.instantiate(this.playerPrefab[24]);\n            //canvasNode.getChildByName(\"buffHeal\").active = false;\n        }\n        \n        //hide select frame\n        this.dispCharSele();\n\n        //remove buff icon\n        if(this.putSele[buff.innerId]) {\n            this.putSele[buff.innerId].parent.destroy();\n        }\n\n        //hide drag item disp\n        //this.hideDragItem(buff.innerId);\n\n        this.clickSele = {};\n\n        px = (buff.mypos.x)*30;\n        py = (buff.mypos.y)*30;\n\n        var moveTo = cc.v2(px, py);\n        myBuff.setPosition(moveTo);\n\n        this.node.addChild(myBuff);\n    },\n\n    createAgents:function(agents) {\n        var aid,myAgent,agent,agentNode;\n        var px,py,eo;\n        //var nodelist = cc.find(\"Canvas/layout\");\n        //console.log(nodelist);\n\n        for(var i=0;i<agents.length;i++) {\n            agent = agents[i];\n\n            aid = agent.aid;\n            myAgent = this.npcInfo.objectForKey(aid);\n            px = (agent.mypos.x)*30;\n            py = (agent.mypos.y)*30;\n\n            if(myAgent == null) {\n                this.hideDragItem(agent.innerId);\n\n                if(agent.role == \"ske\") {\n                    myAgent = cc.instantiate(this.playerPrefab[0]);    \n                }\n                else if(agent.role == \"ir\") {\n                    myAgent = cc.instantiate(this.playerPrefab[20]); \n                }\n                else if(agent.role == \"bee\") {\n                    myAgent = cc.instantiate(this.playerPrefab[16]);    \n                }\n                else if(agent.role == \"wiz\") {\n                    myAgent = cc.instantiate(this.playerPrefab[17]);    \n                }\n                else if(agent.role == \"hr\") {\n                    myAgent = cc.instantiate(this.playerPrefab[12]);    \n                }\n                else if(agent.role == \"lm\") {\n                    myAgent = cc.instantiate(this.playerPrefab[14]);    \n                }\n                else if(agent.role == \"lr\") {\n                    myAgent = cc.instantiate(this.playerPrefab[3]);    \n                }\n                else if(agent.role == \"gi\") {\n                    myAgent = cc.instantiate(this.playerPrefab[4]);    \n                } else {\n                    continue;\n                }\n\n                myAgent.name = aid;\n                myAgent.type = \"agent\";\n                myAgent.active = true;\n                myAgent.role = agent.role;\n                myAgent.size = agent.size;\n                myAgent.level = agent.level;\n\n                agentNode = this.getComponentByRole(myAgent);\n                agentNode.init();\n                agentNode.setId(aid);\n\n                //shadow should set in layout, because its zindex should be lower than any agents.\n                agentNode.setShadow(this.shadowForAgent());\n\n                agentNode.setTotalLife(agent.life);\n                agentNode.setBlood(this.bloodForAgent(myAgent));\n\n                //if init pos is in south, face to north, otherwise....\n                if(this.mainPlayer == 1) {\n                    agent.rot = 180;\n                }\n                else if(this.mainPlayer == 2) {\n                    agent.rot = 0;        \n                }\n\n                px = (agent.mypos.x)*30;\n                py = (agent.mypos.y)*30;\n\n                agentNode.updatePos(px, py);\n\n                this.node.addChild(myAgent);\n                this.npcInfo.setObject(myAgent, aid);\n            }\n        }\n    },\n\n    createBullets:function(bullets) {\n        var aid,myBullet,bullet,agentNode;\n        var px,py,eo,eDis;\n\n        for(var i=0;i<bullets.length;i++) {\n            bullet = bullets[i];\n            aid = bullet.aid;\n            myBullet = this.npcInfo.objectForKey(aid);\n\n            if(myBullet == null) {\n                if(bullet.role==\"bullet\") {\n                    myBullet = cc.instantiate(this.playerPrefab[1]);\n                    myBullet.startPos = bullet.mypos;\n                    myBullet.active = false;\n                }\n                else if(bullet.role==\"bomb\") {\n                    console.log(\"bomb created\");\n                    this.playSnd(\"fireSend\");\n                    this.hideDragItem(bullet.innerId);\n                    myBullet = cc.instantiate(this.playerPrefab[5]);    \n                    eDis = this.enemeyDistance(bullet.mypos.x, bullet.mypos.y, bullet.targetpos.x, bullet.targetpos.y);\n                    myBullet.startPos = bullet.mypos;\n                    myBullet.targetDis = eDis;\n                }\n                else if(bullet.role==\"tama\") {\n                    this.playSnd(\"gun\");\n                    myBullet = cc.instantiate(this.playerPrefab[9]);\n                    myBullet.startPos = bullet.mypos;\n                    myBullet.active = false;\n                }\n                else if(bullet.role==\"wizfire\") {\n                    myBullet = cc.instantiate(this.playerPrefab[18]);\n                    myBullet.startPos = bullet.mypos;\n                    myBullet.active = false;\n                }\n                else {\n                    console.log(\"error, no bullet type.\");\n                }\n\n                myBullet.name = aid;\n                myBullet.type = \"bullet\";\n                //myBullet.active = true;\n                myBullet.role = bullet.role;\n                myBullet.updown = bullet.updown;\n\n                myBullet.zIndex = 9999;\n\n                agentNode = this.getComponentByRole(myBullet);\n\n                // 将新增的节点添加到 Canvas 节点下面\n                this.node.addChild(myBullet);\n\n                px = -1000;\n                py = -1000;\n                var moveTo = cc.v2(px, py);\n\n                var bulletRot = bullet.rot;\n                if(this.mainPlayer == 1) {\n                    bulletRot += 180;\n                }\n\n                //since 2.1.1 setRotation is desperated.\n                myBullet.angle = -1*bulletRot;\n                //myBullet.setRotation(bulletRot);  //bullet.rot+180\n\n                myBullet.setPosition(moveTo);\n\n                this.npcInfo.setObject(myBullet, aid);\n            }\n        }\n    },\n\n    createBases:function(bases) {\n        var aid,myAgent,agent,baseName,baseNode;\n\n        for(var i=0;i<bases.length;i++) {\n            agent = bases[i];\n            aid = agent.aid;\n            myAgent = this.npcInfo.objectForKey(aid);\n\n            if(myAgent == null) {\n                myAgent = {};\n                myAgent.name = aid;\n                myAgent.type = \"base\";\n                myAgent.active = true;\n                myAgent.role = agent.role;\n                myAgent.mypos = agent.mypos;\n                myAgent.size = agent.size;\n\n                baseName = \"base\"+ agent.objectId;\n                myAgent.baseObj = this.node.getChildByName(baseName);\n\n                baseNode = myAgent.baseObj.getComponent(\"BaseSprite\");\n                baseNode.setTotalLife(agent.life);\n                baseNode.setBlood(this.bloodForAgent(myAgent.baseObj));\n                baseNode.setLife(agent.life);\n\n                this.npcInfo.setObject(myAgent, aid);\n            }\n        }\n    },\n\n    createLogs:function(logs) {\n        var aid,myAgent,agent,agentNode;\n        var px,py;\n\n        //this.playSnd(\"log\");\n\n        for(var i=0;i<logs.length;i++) {\n            agent = logs[i];\n            aid = agent.aid;\n\n            myAgent = this.npcInfo.objectForKey(aid);\n            px = (agent.mypos.x)*30;\n            py = (agent.mypos.y)*30;\n\n            if(myAgent == null) {\n                this.hideDragItem(agent.innerId);\n\n                myAgent = cc.instantiate(this.playerPrefab[8]);\n                myAgent.name = aid;\n                myAgent.type = \"log\";\n                myAgent.active = true;\n                myAgent.role = agent.role;\n\n                agentNode = this.getComponentByRole(myAgent);\n                agentNode.setId(aid);\n                agentNode.setShadow(this.shadowForLog());\n\n                var moveTo = cc.v2(px, py);\n                agentNode.move(moveTo);\n\n                // 将新增的节点添加到 Canvas 节点下面\n                this.node.addChild(myAgent);\n                this.playSnd(\"log\");\n\n                this.npcInfo.setObject(myAgent, aid);\n            }\n        }\n    },\n\n    createForts:function(forts) {\n        var aid,myAgent,agent,agentNode;\n        var px,py,eo,zorder;\n\n        //var nodelist = cc.find(\"Canvas/layout\");\n        //console.log(nodelist);\n\n        for(var i=0;i<forts.length;i++) {\n            agent = forts[i];\n            aid = agent.aid;\n            myAgent = this.npcInfo.objectForKey(aid);\n            px = (agent.mypos.x)*30;\n            py = (agent.mypos.y)*30;\n\n            if(myAgent == null) {\n                this.hideDragItem(agent.innerId);\n\n                myAgent = cc.instantiate(this.playerPrefab[7]);    \n                myAgent.name = aid;\n                myAgent.type = \"fa\";\n                myAgent.spName = \"FortASprite\";\n                myAgent.active = true;\n                myAgent.role = agent.role;\n                myAgent.size = agent.size;\n\n                //1000:agent, 999:bullet 998:this;\n                //fort base anchorY is middle, so y-2 is nessesary.\n                if(this.mainPlayer == 1) {\n                    zorder = 1001+parseInt(32-agent.mypos.y-1);\n                } \n                else if(this.mainPlayer == 2) {\n                    zorder = 1001+parseInt(32-agent.mypos.y-1);\n                }\n                myAgent.zIndex = zorder;\n\n                agentNode = this.getComponentByRole(myAgent);\n                agentNode.setZIndex(zorder);\n/*                \n                //agentNode.init();\n                //agentNode.setId(aid);\n                //agentNode.setShadow(this.shadowForAgent());\n*/\n\n                agentNode.setTotalLife(agent.life);\n                agentNode.setBlood(this.bloodForAgent(myAgent));\n\n                //if init pos is in south, face to north, otherwise....\n                if(this.mainPlayer == 1) {\n                    agent.rot = 180;\n                }\n                else if(this.mainPlayer == 2) {\n                    agent.rot = 0;        \n                }\n\n                var moveTo = cc.v2(px, py);\n                myAgent.setPosition(moveTo);\n\n                //agentNode.playAngleAnimation(agent, null, this.mainPlayer);\n\n                // 将新增的节点添加到 Canvas 节点下面\n                this.node.addChild(myAgent);\n\n                this.npcInfo.setObject(myAgent, aid);\n            }\n        }\n    },\n\n    agentProcess: function(agents) {\n        var remoteAgents = [];\n        var localAgents = [];\n        var killAgents = [];\n        var agentObj, agentNode;\n        var agentId;\n\n        for(var i=0;i<agents.length;i++) {\n            remoteAgents.push(agents[i].aid);\n        }\n\n        localAgents = this.npcInfo.allKeys();\n        killAgents = localAgents.minus(remoteAgents);\n\n        for(agentId of killAgents) {\n            agentObj = this.npcInfo.objectForKey(agentId);\n            if(agentObj.type == \"agent\") {\n                agentNode = this.getComponentByRole(agentObj);\n                agentNode.remove();\n                this.removedNpcInfo.setObject(agentObj, agentId);\n                this.npcInfo.removeObjectForKey(agentId);\n            }\n        }\n    },\n\n    baseProcess: function(bases) {\n        var remoteBases = [];\n        var killBases = [];\n        var enemyBases = [];\n        var baseObj;\n        var warriorName;\n        var warriorObj;\n        var baseName;\n\n        for(var i=0;i<bases.length;i++) {\n            baseName = \"base\"+ bases[i].objectId;\n            remoteBases.push(baseName);\n            enemyBases.push(baseName);\n        }\n\n        // todo list: should manage to remove the base record in npcInfo.\n        killBases = this._defaultBases.minus(remoteBases);\n\n        for(baseName of killBases) {\n            this.dispLayoutMask(enemyBases, baseName);\n\n            this._defaultBases.removeByValue(baseName);\n            baseObj = this.node.getChildByName(baseName);\n\n            //this.plusBaseKillNum(baseName);\n            \n            this.node.removeChild(baseObj);\n            this.playEffect(\"base\", baseObj.x, baseObj.y);\n        }\n    },\n \n    plusBaseKillNum: function(baseName) {\n        //todo: layout node must be set in init \n        var enemynum = this.node.getChildByName(\"upFlag\").getChildByName(\"ringMark\").getChildByName(\"killnum\").getComponent(\"cc.Label\");\n        var mynum = this.node.getChildByName(\"downFlag\").getChildByName(\"ringMark\").getChildByName(\"killnum\").getComponent(\"cc.Label\");\n        \n        if(baseName.inArray([\"base1\", \"base2\", \"base3\"])) {\n            enemynum.string = parseInt(enemynum.string)+1;\n        } else {\n            mynum.string = parseInt(enemynum.string)+1;            \n        }\n    },\n\n    //called when game is over\n    killBases:function(dir) {\n        //todo: layout node must be set in init \n        //var enemynum = this.node.getChildByName(\"upFlag\").getChildByName(\"ringMark\").getChildByName(\"killnum\").getComponent(\"cc.Label\");\n        //var mynum = this.node.getChildByName(\"downFlag\").getChildByName(\"ringMark\").getChildByName(\"killnum\").getComponent(\"cc.Label\");\n      \n        var killBases;\n        var baseObj, bd;\n        var baseName;\n        if(dir == \"up\") {\n            killBases= [\"base1\", \"base2\", \"base3\"];\n            //enemynum.string = 3;\n        } else {\n            killBases= [\"base4\", \"base5\", \"base6\"];\n            //mynum.string = 3;\n        }\n\n        for(baseName of killBases) {\n            //this._defaultBases.removeByValue(baseName);\n            baseObj = this.node.getChildByName(baseName);\n\n            if(baseObj) {\n                this.playEffect(\"base\", baseObj.x, baseObj.y);\n                this.node.removeChild(baseObj);\n            }\n        }\n    },\n\n    undisplayMask: function(sel) {\n        console.log(sel);\n        this.node.getChildByName(sel).active=false;\n    },\n\n    dispLayoutMask: function(killEnemyBases, baseName) {\n        var _self = this;\n        if(baseName == \"base4\" || baseName == \"base5\" || baseName == \"base6\") {\n            return;\n        }\n\n        //if(\"base1\".inArray(killEnemyBases) && \"base2\".inArray(killEnemyBases) && \"base3\".inArray(killEnemyBases)) {\n        //    return;\n        //}\n\n        if(\"base1\".inArray(killEnemyBases) && \"base2\".inArray(killEnemyBases)) {\n            this.showMask(\"seleMask12\", 2);\n        }\n        else if(\"base1\".inArray(killEnemyBases) && \"base3\".inArray(killEnemyBases)) {\n            this.showMask(\"seleMask13\", 2);\n        }\n        else if(\"base1\".inArray(killEnemyBases)) {\n            this.showMask(\"seleMask1\", 2);\n        }\n    },\n\n    showDragMask: function(role) {\n        if(!this.ifNotMaskRole(role)) {\n            this.node.getChildByName(this.maskType).active=true;\n        }\n    },\n\n    unshowDragMask: function() {\n        this.node.getChildByName(this.maskType).active=false;\n    },\n\n    showMask: function(maskType, delay) {\n        var _self = this;\n        this.maskType = maskType;\n        this.node.getChildByName(maskType).active=true;\n        this.scheduleOnce(function() {\n            _self.undisplayMask(maskType);\n        }, delay);\n    },\n\n    putErrorMsg: function() {\n        var _self = this;\n        this.node.getChildByName(\"putError\").active=true;\n        this.scheduleOnce(function() {\n            _self.undisplayPutErr();\n        }, 1);\n    },\n\n    undisplayPutErr: function() {\n        this.node.getChildByName(\"putError\").active=false;\n    },\n\n    fortProcess: function(forts, fortsFuture) {\n        var remoteAgents = [];\n        var localAgents = [];\n        var killAgents = [];\n        var agentObj, agentNode;\n        var agentId, bd;\n\n        for(var i=0;i<forts.length;i++) {\n            remoteAgents.push(forts[i].aid);\n        }\n\n        localAgents = this.npcInfo.allKeys();\n        killAgents = localAgents.minus(remoteAgents);\n\n        for(agentId of killAgents) {\n            agentObj = this.npcInfo.objectForKey(agentId);\n            if(agentObj.type == \"fa\") {\n                this.playEffect(\"fort\", agentObj.x, agentObj.y);\n\n                //agentNode = this.getComponentByRole(agentObj);\n                //agentNode.remove();\n                this.node.removeChild(agentObj);\n                this.removedNpcInfo.setObject(agentObj, agentId);\n                this.npcInfo.removeObjectForKey(agentId);\n\n                this.playEffect(\"base\", agentObj.x, agentObj.y);\n            }\n        }\n    },\n\n    logProcess: function(logs) {\n        var remoteAgents = [];\n        var localAgents = [];\n        var killAgents = [];\n        var agentObj, agentNode;\n        var agentId, bd;\n\n        for(var i=0;i<logs.length;i++) {\n            remoteAgents.push(logs[i].aid);\n        }\n\n        localAgents = this.npcInfo.allKeys();\n        killAgents = localAgents.minus(remoteAgents);\n\n        for(agentId of killAgents) {\n            agentObj = this.npcInfo.objectForKey(agentId);\n            if(agentObj.role == \"log\") {\n                this.playEffect(\"log\", agentObj.x, agentObj.y);\n\n                agentNode = this.getComponentByRole(agentObj);\n                agentNode.remove();\n                this.removedNpcInfo.setObject(agentObj, agentId);\n                this.npcInfo.removeObjectForKey(agentId);\n            }\n        }\n    },\n\n    bulletProcess: function(bullets) {\n        var remoteBullets = [];\n        var localBullets = [];\n        var killBullets = [];\n        var agentObj, agentNode;\n        var agentId;\n\n        for(var i=0;i<bullets.length;i++) {\n            remoteBullets.push(bullets[i].aid);\n        }\n\n        localBullets = this.npcInfo.allKeys();\n        killBullets = localBullets.minus(remoteBullets);\n\n        for(agentId of killBullets) {\n            agentObj = this.npcInfo.objectForKey(agentId);\n            if(agentObj.role == \"bomb\") {\n                agentNode = this.getComponentByRole(agentObj);\n                agentObj.destroy();\n                this.removedNpcInfo.setObject(agentObj, agentId);\n                this.npcInfo.removeObjectForKey(agentId);\n                this.playEffect(\"bomb\", agentObj.x, agentObj.y);\n            }\n            if(agentObj.role == \"wizfire\") {\n                agentNode = this.getComponentByRole(agentObj);\n                agentObj.destroy();\n                this.removedNpcInfo.setObject(agentObj, agentId);\n                this.npcInfo.removeObjectForKey(agentId);\n                if(agentObj.x && agentObj.y) {\n                    this.playEffect(\"wizfire\", agentObj.x, agentObj.y);\n                }\n            }\n            else if(agentObj.role == \"bullet\" || agentObj.role == \"tama\") {\n                agentNode = this.getComponentByRole(agentObj);\n                agentObj.destroy();\n                this.removedNpcInfo.setObject(agentObj, agentId);\n                this.npcInfo.removeObjectForKey(agentId);\n            }\n        }\n    },\n\n    //shake the screen\n    startSceneJitter: function(){\n        var sceneNode = this.node;\n        var ox = sceneNode.x;\n        var oy = sceneNode.y;\n\n        var cnt = 0;\n\n        var lower = -4;\n        var upper = 4;\n        var callBack = function(){\n            cnt++;\n            var randomX = Math.floor(Math.random() * (upper - lower)) + lower;\n            var randomY = Math.floor(Math.random() * (upper - lower)) + lower;\n            \n            sceneNode.x += randomX;\n            sceneNode.y += randomY;\n            if(cnt>=10) {\n                sceneNode.stopAllActions();\n                sceneNode.x = ox;\n                sceneNode.y = oy;\n            }\n        }\n\n        var node = this.node;//场景常驻节点\n        var del = cc.delayTime(1/30);\n        var cal = cc.callFunc(callBack);\n        var seq = cc.sequence(del, cal);\n        node.runAction(cc.repeatForever(seq));\n    },\n\n    playBases: function(bases) {\n        var remoteBases = [];\n        var baseObj,myAgent,agent;\n        var warriorName;\n        var warriorObj;\n        var baseName, kingNode, agentNode, kingArrow,warrior;\n        var actType, attackDura, now;\n        var tmpB = {};\n        var eoDead;\n        var eo = null;\n\n        for(var i=0;i<bases.length;i++) {\n            agent = bases[i];\n\n            baseName = \"base\"+ agent.objectId;\n            attackDura = agent.attackDura;\n            myAgent = this.npcInfo.objectForKey(agent.aid).baseObj;\n\n            tmpB[agent.aid] = baseName;\n            remoteBases.push(baseName);\n            actType = agent.actType;\n\n            if(myAgent) {\n                myAgent.getComponent(\"BaseSprite\").setLife(agent.life);\n\n                warrior = myAgent.getChildByName(\"warrior\");\n                if(warrior) {\n                    warrior.role = \"lr\";\n                    agentNode = this.getComponentByRole(warrior);\n\n                    //if no enmey then standby\n                    if(myAgent && agent.actType==\"wait\") {\n                        agentNode.playBaseWarriorAnimationDefault(\"move\", agent.objectId);\n                    }\n                    else if(myAgent && agent.actType==\"sa\") {\n                        agentNode.playBaseWarriorAnimation(agent, this.mainPlayer, \"sa\");\n                    }                     \n                }\n                warrior = myAgent.getChildByName(\"gun\");\n                if(warrior) {\n                    warrior.role = \"gun\";\n                    agentNode = this.getComponentByRole(warrior);\n\n                    //if no enmey then standby\n                    if(myAgent && agent.actType==\"wait\") {\n                        //agentNode.playFortWarriorAnimationDefault(\"move\", this.mainPlayer, agent.objectId);\n                    }\n                    else if(myAgent && agent.actType==\"sa\") {\n                        agentNode.playBaseWarriorAnimation(agent, this.mainPlayer, \"sa\");\n                    }                     \n                }\n            }\n        }\n    },\n\n    playAgents: function(agents, agentsFuture) {\n        var myAgent;\n        var px, py, aid;\n        var agentNode,agent,eo=null;\n        var eoDead;\n\n        for(var i=0;i<agents.length;i++) {\n            agent = agents[i];\n            myAgent = this.npcInfo.objectForKey(agent.aid);\n\n            if(myAgent && myAgent.type==\"agent\") {\n                agentNode = this.getComponentByRole(myAgent);\n                agentNode.playAni(agent, this.getFutureAgent(agent.aid, agentsFuture), this.mainPlayer);\n                agentNode.setLife(agent.life);\n                agentNode.setGroupKill(agent.groupKill);\n\n                px = Math.round((agent.mypos.x)*30);\n                py = Math.round((agent.mypos.y)*30);\n                agentNode.updatePos(px, py);\n            }\n        }\n    },\n\n    playForts: function(forts) {\n        var myAgent;\n        var agentNode,agent,warrior=null;\n\n        for(var i=0;i<forts.length;i++) {\n            agent = forts[i];\n            myAgent = this.npcInfo.objectForKey(agent.aid);\n            if(!myAgent) {\n                continue;\n            }\n            myAgent.role = \"fa\";\n            agentNode = this.getComponentByRole(myAgent);\n            agentNode.setLife(agent.life);\n\n            warrior = myAgent.getChildByName(\"warrior\");\n            warrior.role = \"lr\";\n            agentNode = this.getComponentByRole(warrior);\n\n            //if no enmey then standby\n            if(myAgent && agent.actType==\"move\") {\n                agentNode.playFortWarriorAnimationDefault(\"move\", agent.isHero, this.mainPlayer);\n            }\n            else if(myAgent && agent.actType==\"sa\") {\n                agentNode.playBaseWarriorAnimation(agent, this.mainPlayer, \"sa\");\n            } \n        }\n    },\n\n    playLogs: function(logs) {\n        var agent,myAgent;\n        var px, py, aid;\n        var agentNode,bullet,eo=null;\n        var sc;\n        var moveTo;\n\n        for(var i=0;i<logs.length;i++) {\n            agent = logs[i];\n            myAgent = this.npcInfo.objectForKey(agent.aid);\n\n            if(myAgent) {\n                agentNode = this.getComponentByRole(myAgent);\n                agentNode.move(agent.mypos);\n            }\n        }\n    },\n\n    playBullets: function(bullets) {\n        var myBullet;\n        var px, py, aid;\n        var agentNode,bullet,eo=null;\n        var sc;\n        var moveTo, bulletRot;\n\n        for(var i=0;i<bullets.length;i++) {\n            bullet = bullets[i];\n\n            myBullet = this.npcInfo.objectForKey(bullet.aid);\n            if(myBullet) {\n                myBullet.active = true;\n\n                agentNode = this.getComponentByRole(myBullet);\n\n                if(myBullet.role == \"bomb\") {\n                    sc = this.getFireBombScale(bullet.mypos, bullet.targetpos, myBullet.targetDis, myBullet.startPos);\n                    myBullet.scaleX=sc;\n                    myBullet.scaleY=sc;\n/*\n                    var randomTime = Math.ceil(Math.random()*40)-10;\n                    var fh = myBullet.getChildByName(\"fireHead\");\n                    //fh.skewY = randomTime;\n                    //fh.skewX = randomTime;\n\n                    //fire bomb size changing according to the distance between target and origin.\n                    sc = this.getFireBombScale(bullet.mypos, bullet.targetpos, myBullet.targetDis, myBullet.startPos);\n                    agentNode.node.scaleX=sc;\n                    agentNode.node.scaleY=sc;\n                    myBullet.getComponent(cc.MotionStreak).stroke *= sc;\n*/\n                }\n\n                //2 fort bullet emit the same time, only display the proper bullet.\n                if(bullet.updown==\"up\" && this.mainPlayer==2) {\n                    continue;\n                }\n                if(bullet.updown==\"down\" && this.mainPlayer==1) {\n                    continue;\n                }\n\n                px = (bullet.mypos.x)*30;\n                py = (bullet.mypos.y)*30;\n\n\n                moveTo = cc.v2(px, py);\n\n                bulletRot = bullet.rot;\n                if(this.mainPlayer == 1) {\n                    bulletRot += 180;\n                }\n\n                //1000:agent, 999:this bullet 998:forts;\n                //make bullet display under agent which is at same position.\n                myBullet.zIndex = 1000+parseInt(32-bullet.mypos.y);\n\n                //if bomb, then shake a little bit;\n                if(myBullet.role == \"bomb\" || myBullet.role == \"wizfire\") {\n                    myBullet.zIndex = 9999;\n                    //var randomTime = Math.ceil(Math.random()*40)-10;\n                    //bulletRot += randomTime;\n                }\n\n\n\n                //since 2.1.1 setRotation is desperated.\n                myBullet.angle = -1*bulletRot;                \n                //myBullet.setRotation(bulletRot);\n                myBullet.setPosition(moveTo);\n            }\n        }\n    },\n\n    getFireBombScale: function(bulletPos, targetPos, targetDis, startPos) {\n        var xDif, yDif;\n        var midPos = {};\n        midPos.x = startPos.x + (targetPos.x - startPos.x)/2;\n        midPos.y = startPos.y + (targetPos.y - startPos.y)/2;\n        var xDif = bulletPos.x - midPos.x;\n        var yDif = bulletPos.y - midPos.y;\n        var dis = Math.sqrt((xDif * xDif) + (yDif * yDif));\n        var targetDis = targetDis * 0.5;\n\n        return (targetDis-dis)*0.7/targetDis+0.5;   //scale from 0.5 -- 1.2\n    },\n\n    enemeyDistance:function(px,py,ex,ey) {\n        var xDif, yDif, dis;\n        xDif = px - ex;\n        yDif = py - ey;\n        dis = Math.sqrt((xDif * xDif) + (yDif * yDif));\n        return dis;\n    },\n\n    getComponentByRole(agentObj) {\n        var role = agentObj.role;\n        if(role == \"ske\") {\n            return agentObj.getComponent('SkeSprite');\n        }\n        else if(role == \"ir\") {\n            return agentObj.getComponent('SkeSprite');\n        }\n        else if(role == \"bee\") {\n            return agentObj.getComponent('BeeSprite');\n        }\n        else if(role == \"wiz\") {\n            return agentObj.getComponent('WizSprite');\n        }\n        else if(role == \"hr\") {\n            return agentObj.getComponent('HeroSprite');\n        }\n        else if(role == \"lm\") {\n            return agentObj.getComponent('LightmanSprite');\n        }\n        else if(role == \"lr\") {\n            return agentObj.getComponent('ArcSprite');\n        }\n        else if(role == \"gi\") {\n            return agentObj.getComponent('GiantSprite');\n        }\n        else if(role == \"bullet\") {\n            return agentObj.getComponent('Arrow');\n        }\n        else if(role == \"bomb\") {\n            return agentObj.getComponent('BombScript');\n        }\n        else if(role == \"log\") {\n            return agentObj.getComponent('LogSprite');\n        }\n        else if(role == \"gun\") {\n            return agentObj.getComponent('GunSprite');\n        }\n        else if(role == \"base\") {\n            return agentObj.getComponent('BaseSprite');\n        }\n        else if(role == \"fa\") {\n            return agentObj.getComponent('BaseSprite');\n        }\n    },\n\n    getKilledEnemies: function() {\n        var aids = this.removedNpcInfo.allKeys();\n        var aid;\n        var killedEnemies = [];\n        //when one attack cause multi kills occured in one frame, multi enemies must be handled. \n        for(var i=0;i<aids.length;i++) {\n            aid = aids[i];\n            killedEnemies.push(this.removedNpcInfo.objectForKey(aid));\n        }\n\n        return killedEnemies;\n    },\n\n    getFutureAgent: function(aid, agentsFuture) {\n        for(var i=0;i<agentsFuture.length;i++) {\n            if(agentsFuture[i].aid == aid) {\n                return agentsFuture[i];\n            }\n        }\n        return null;\n    },\n\n    bloodForAgent: function (agent) {\n        var bloodObj = cc.instantiate(this.playerPrefab[11]);\n        var bloodOp = bloodObj.getComponent(\"BloodBar\");\n        bloodOp.setBarLevel(agent.level);\n\n        bloodObj.active = false;\n        agent.addChild(bloodObj);\n        return bloodObj;\n    },\n\n    shadowForAgent: function () {\n        var shadowObj = cc.instantiate(this.playerPrefab[2]);\n        shadowObj.active = false;\n        this.node.addChild(shadowObj);\n        return shadowObj;\n    },\n\n    shadowForLog: function () {\n        var shadowObj = cc.instantiate(this.playerPrefab[2]);\n        // 将新增的节点添加到 Canvas 节点下面\n\n        shadowObj.scaleX = 1;\n        shadowObj.sacleY = 1;\n        shadowObj.active = false;\n        this.node.addChild(shadowObj);\n        return shadowObj;\n    },\n\n    setClickItem: function (select) {\n        this.clickSele = select;\n    },\n\n    putClickItem: function (selCard, node, pt) {\n        var putNode = cc.instantiate(node);\n        var innerId = this.nick +\"_\"+ Number(new Date());\n\n        putNode.x = pt.x;\n        putNode.y = pt.y;\n        putNode.name = innerId;\n        putNode.active = true;\n        selCard.addChild(putNode);\n\n        this.putSele[innerId] = putNode;\n\n        return innerId;\n    },\n\n    setDragItem: function (params, node) {\n        var card = params.target;\n        var dragNode = cc.instantiate(node);\n        var innerId = this.nick +\"_\"+ Number(new Date());\n\n        node.x = 0;\n        node.y = 0;\n        dragNode.name = innerId;\n        dragNode.actvie = true;\n        card.addChild(dragNode);\n\n        this.putSele[innerId] = dragNode;\n        this.draggingItem = innerId;\n\n        return innerId;\n    },\n\n    unsetDragItem: function (innerId) {\n        this.unshowDragMask();\n        this.draggingItem = \"\";\n        this.putSele[innerId].destroy();\n        this.putSele[innerId] = null;     \n    },\n\n    moveDragItem: function(sel, delta) {\n        if(this.putSele[this.draggingItem]) {\n            this.putSele[this.draggingItem].x += delta.x;\n            this.putSele[this.draggingItem].y += delta.y;   \n            \n            if(this.putSele[this.draggingItem].y < 0) {\n                //this.putSele[this.draggingItem].y = 0\n            }\n        }\n    },\n\n    clearDragItem: function(param, select) {\n        var innerId;\n        var card = param.target;\n        var sel = card._name;\n        var pt={};\n        var layoutPt = this.node.position;\n        var yOffset=0;\n        var magicCost = select.magicCost;\n        var level = select.level;\n        var role = select.role;\n\nconsole.log(\"role:\" + role);\n\n        this.unshowDragMask();\n\n        if(this.mainPlayer==1) {\n            yOffset=-50;\n        } else {\n            yOffset=20;\n        }\n\n        if(this.putSele[this.draggingItem]) {\n            innerId = this.putSele[this.draggingItem].name;\n\n            //layout maybe scaled according to devices.\n            pt.x = (this.putSele[this.draggingItem].x+card.x-layoutPt.x)/this.node.scaleX;\n            pt.y = (this.putSele[this.draggingItem].y+card.y-layoutPt.y+yOffset)/this.node.scaleY;\n\n            if(!this.isValidPutPoint(pt) && !this.ifNotMaskRole(role)) {\n                console.log(\"invalid postion.\");\n                this.putSele[innerId].destroy();\n                this.putSele[innerId] = null;\n                this.putErrorMsg();\n                return;\n            }\n\n            this.sendSodier(magicCost, role, pt, innerId, level);\n            this.draggingItem = \"\";\n        } \n    },\n\n    sendSodier: function(magicCost, role, pt, innerId, level) {\n        //var innerId = this.nick +\"_\"+ Number(new Date());\n        var isHero = (this.mainPlayer==1);\n        var bar = this.canvasNode.getChildByName(\"magicBar\");\n        var juice = bar.getChildByName(\"juice\");\n        var cost = this.useMagic(magicCost);\n\n        this.playSnd(\"put1\");\n\n        if(cost) {\n            juice.width = cost;\n            MY_SOCKET.json.emit('cmd', {'isHero':isHero, 'roomId': this.roomId, 'innerId': innerId, 'role': role, 'pt':pt, 'level':level});\n        } else {\n            this.putSele[innerId].destroy();\n            this.putSele[innerId] = null;            \n        }\n    },\n\n    setMagicBar: function() {\n        var bar = this.canvasNode.getChildByName(\"magicBar\");\n        var juice = bar.getChildByName(\"juice\");\n\n        if(juice.width<600) {\n            juice.width+=this.addJuice;\n        }\n\n        if(juice.width%50 == 0) {\n            this.magicAmount = juice.width/50;\n            this.updateCardStatus();\n        }\n    },\n\n    useMagic: function(amount) {\n        var bar = this.canvasNode.getChildByName(\"magicBar\");\n        var juice = bar.getChildByName(\"juice\");\n        var afterUse = juice.width-amount*50;\n\n        if(afterUse>=0) {\n            return afterUse;\n        }\n        return false;\n    },\n\n    updateCardStatus: function() {\n        var head = \"sel\";\n        var nodeName, selNode;\n        var selSprite = null;\n\n        for(var i=1;i<=7;i++) {\n            nodeName = head + i;\n            selNode = this.canvasNode.getChildByName(nodeName);\n            if(selNode) {\n                selSprite = selNode.getComponent('SelCard');\n                if(selSprite) {\n                    if(selSprite.magicCost <= this.magicAmount) {\n                        selNode.color = new cc.Color(255,255,255);\n                    } else {\n                        selNode.color = new cc.Color(127,127,127);\n                    }\n                }                \n            }\n        }\n    }\n});\n"]}