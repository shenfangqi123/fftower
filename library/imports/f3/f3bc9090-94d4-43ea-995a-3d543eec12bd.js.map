{"version":3,"sources":["assets/scripts/Game.js"],"names":["common","require","gameProvider","cc","_Dictionary","Class","properties","playerPrefab","type","Prefab","audios","AudioClip","ctor","console","log","bufferLen","goback","event","customEventData","syncTimeout","director","loadScene","onLoad","_parent","netErrDisp","size","visibleRect","name","getRandomCharName","nick","canvasNode","node","parent","resultOp","getChildByName","getComponent","gameCountDown","mainPlayer","roomId","baseAttackDuraRec","agentMoveStepRec","_defaultBases","gameStartTime","gameCycleTime","gameOver","addJuice","npcInfo","removedNpcInfo","setUser","getPersistantData","socketHandle","putSele","dragingItem","clickSele","magicAmount","maskType","canvasPt","getPosition","layoutPt","cnode","pl","magicCost","role","selParams","selNode","innerId","on","Node","EventType","TOUCH_END","params","pt","getLocation","clickProcessor","initEventListener","find","getData","def","titlenode","levelLabel","nameLabel","scoreLabel","string","getNick","level","myscore","setConnFailInfo","msgLabel","retBut","active","setBuffDisp","buffType","setParam","param","timestamp","curTime","Date","getTime","setMyCards","dispCharSele","sx","sy","mx","my","card","cardNode","cost","moveTo","allCards","rowItems","rows","cols","head","i","length","instantiate","_name","setRole","seleRole","roleLevel","v2","setPosition","addChild","charSele","zIndex","gameOverProcessor","data","win","killBases","clickPt","pt1","undefined","selCard","target","yOffset","x","y","scaleX","scaleY","ifNotMaskRole","showMask","isValidPutPoint","putErrorMsg","putClickItem","sendSodier","point","onEventEffect","bind","setCountDown","counter","min","parseInt","sec","timeNode","cdNode","doubleMagicDisp","dispnode","setTimeCounter","cnt","gameNowTime","setMagicBar","count_down","tens","ones","startTraceTimer","interval","then","now","game_cycle","game_cycle_then","cycle_cnt","traceTimer","delta","game_cycle_delta","Math","abs","mainGameCycle","schedule","agents","bullets","bases","forts","rollLogs","agentsFuture","fortsFuture","gameTraceStack","shift","playBullets","playLogs","playAgents","playBases","playForts","bulletProcess","logProcess","agentProcess","fortProcess","baseProcess","stopTraceTimer","MY_SOCKET","disconnect","unschedule","playSnd","sndType","audioEngine","play","playEffect","bd","startSceneJitter"],"mappings":"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","sourceRoot":"/","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/creator/en/scripting/life-cycle-callbacks.html\n\nvar common = require(\"Common\");\nvar gameProvider = require(\"GameProvider\");\ncc._Dictionary = require(\"Dictionary\");\n\ncc.Class({\n    extends: gameProvider,\n\n    properties: {\n        // 这个属性引用了预制资源\n        playerPrefab: {\n            default: [],\n            type: cc.Prefab\n        },\n        audios: {\n            default: [],\n            type: cc.AudioClip\n        }\n    },\n\n    ctor() {\n        console.log(\"-----ctor----\");\n        this.bufferLen = 30;\n    },\n\n    goback: function (event, customEventData) {\n        this.syncTimeout();\n        cc.director.loadScene('menu');\n    },\n\n    onLoad: function () {\n        console.log(\"---------onLoad--------\");\n\n/*\n        if (typeof (wx) !== \"undefined\") {\n            let self = this;\n            wx.onShow(function () {\n                console.log(\"wx onshow.\");\n                if (self.isShared && self.shareTag == \"keys\") {\n                    let curTime = new Date().getTime();\n                    if (curTime - self.closeTime >= 3000) {\n                        //分享成功\n                        console.log(\"分享成功\");\n                        //self.isShared = false;\n                        //self.shareTag = \"\";\n                        //self.closeTime = curTime;\n                    }\n                }\n            })\n        }\n*/\n\n        var _parent = this;\n        this.netErrDisp = false;\n        var size = cc.visibleRect;\n        var name = this.getRandomCharName();\n        this.nick = name;\n\n        this.canvasNode = this.node.parent;\n        this.resultOp = this.node.getChildByName(\"Result\").getComponent(\"Result\");\n\n        this.gameCountDown = 150; //2:30\n        //up user or down user.\n        this.mainPlayer = -1;\n        this.roomId = \"\";\n\n        this.baseAttackDuraRec = [];\n        this.agentMoveStepRec = [];\n        this._defaultBases = [\"base1\",\"base2\",\"base3\",\"base4\",\"base5\",\"base6\"];\n        \n        this.gameStartTime = 0;\n        this.gameCycleTime = 90;\n        this.gameOver=false;\n        this.addJuice = 10;  //each heart add up to magic juice bar\n\n        this.npcInfo = new cc._Dictionary();\n        this.removedNpcInfo = new cc._Dictionary();\n        this.setUser(this.getPersistantData());\n\n        console.log(\"name:\" + name);\n        this.socketHandle(this.nick);\n\n        this.putSele = [];\n        this.dragingItem = \"\";\n\n        this.clickSele = {};\n        this.magicAmount = 0;\n\n        //red alert area should not be entered by hero.\n        this.maskType = \"seleMask3\";\n\n        var canvasPt = this.node._parent.getPosition();\n        var layoutPt = this.node.getPosition();\n        var cnode, pl;\n        var magicCost = 0;\n        var role;\n        var selParams, selNode;\n        var innerId;\n\n        this.node.on(cc.Node.EventType.TOUCH_END, function (params) {\n            if(_parent.gameStartTime == 0) {\n                return;\n            }\n            var pt = params.getLocation();\n            _parent.clickProcessor(pt);\n        });\n\n/*\n        this.listener = cc.EventListener.create({\n            event: cc.EventListener.CUSTOM,  \n            eventName: \"event_effect\",\n            callback: function (event) {\n                cc.log(\"event = \"+event.getUserData());\n            }\n        });\n        cc.eventManager.addListener(this.listener, 1);\n*/\n\n        this.initEventListener();\n    },\n\n    getPersistantData: function() {\n        var node = cc.find('GameData').getComponent('GameData');\n        return node.getData();\n    },\n\n    setUser: function(def) {\n        var node = cc.find('GameData').getComponent('GameData');\n        var titlenode = this.node.parent.getChildByName(\"banner\").getChildByName(\"title\");\n        var levelLabel = this.node.parent.getChildByName(\"banner\").getChildByName(\"level\").getChildByName(\"levelword\").getComponent(\"cc.Label\");\n        var nameLabel = titlenode.getChildByName(\"name\").getComponent(\"cc.Label\");\n        var scoreLabel = titlenode.getChildByName(\"score\").getComponent(\"cc.Label\");\n\n        nameLabel.string = node.getNick();\n        levelLabel.string = def.level;\n        scoreLabel.string = def.myscore;\n    },\n\n    setConnFailInfo: function() {\n        this.netErrDisp = true;\n        var msgLabel = this.node.getChildByName(\"putWait\").getChildByName(\"msg\").getComponent(\"cc.Label\");\n        var retBut = this.node.getChildByName(\"putWait\").getChildByName(\"retBut\");\n        retBut.active = true;\n        msgLabel.string = \"ネット障害\";\n    },\n\n    setBuffDisp: function(buffType) {\n        var canvasNode = this.node.parent;\n        this.buffType = buffType;\n        if(buffType == \"heal\") {\n            canvasNode.getChildByName(\"buffHeal\").active = true;\n        }\n        else if(buffType == \"thunder\") {\n            canvasNode.getChildByName(\"buffThunder\").active = true;            \n        }\n    },\n\n/*\n    doBuff: function(event, customEventData) {\n        console.log(\"sssss:\" + customEventData);\n        var buffType = customEventData;\n        if(buffType == 1) {\n        }\n    },\n*/\n\n    setParam: function(param, timestamp) {\n        console.log(\"----param----\");\n        console.log(param);\n        console.log(timestamp);\n\n        var curTime = new Date().getTime();\n\n        console.log(\"duration:\" + (curTime - timestamp));\n\n        this.setMyCards(param);\n        this.dispCharSele();\n    },\n\n    setMyCards: function(param) {\n        var sx = -230;\n        var sy = -590;\n        var mx, my;\n        var card, cardNode, cost;\n        var moveTo;\n        //var allCards = [\"log\",\"bomb\",\"ske\",\"ir\"];\n        var allCards = param;\n        var rowItems = 0;\n        var rows = 0;\n        var cols = 0;\n        var canvasNode = this.node.parent;\n        var head = \"sel\";\n\n        for(var i=0;i<allCards.length;i++) {\n            card = cc.instantiate(this.playerPrefab[21]);\n            card._name = head + (i+1);\n            cardNode = card.getComponent('SelCard');\n            if(allCards[i]) {\n                cost = 1;\n                cardNode.setRole(allCards[i].seleRole, allCards[i].magicCost, allCards[i].roleLevel);\n            }\n\n            //this.myCardNodes.push(cardNode);                \n            cols = i%6;\n            mx = sx+(cols*105);\n            my = sy;\n            moveTo = cc.v2(mx, my);\n            card.setPosition(moveTo);\n            canvasNode.addChild(card);\n        }\n\n        for(var i=allCards.length;i<6;i++) {\n            cols = i%6;\n            mx = sx+(cols*105);\n            my = sy;\n            card = cc.instantiate(this.playerPrefab[22]);\n            moveTo = cc.v2(mx, my);\n            card.setPosition(moveTo);\n            canvasNode.addChild(card);\n        }\n    },\n\n    dispCharSele: function() {\n        var charSele = this.node.parent.getChildByName(\"charSele\");\n        charSele.zIndex = 9999;\n        charSele.active = false;\n        console.log(charSele);\n    },\n\n    gameOverProcessor:function(mainPlayer, data) {\n        if(mainPlayer == 1) {\n            if(data.win == 1) {\n                console.log(\"my win11\");\n                this.killBases(\"up\");\n            }\n            else if(data.win == 0) {\n                console.log(\"my lose11\");\n                this.killBases(\"down\");\n            }\n        }\n        else if(mainPlayer == 2) {\n            if(data.win == 1) {\n                console.log(\"my lose11\");\n                this.killBases(\"down\");\n            }\n            else if(data.win == 0) {\n                console.log(\"my win11\");\n                this.killBases(\"up\");\n            }\n        }\n    },\n\n    clickProcessor:function (clickPt) {\n        var _parent = this;\n      \n        var canvasPt = this.canvasNode.getPosition();\n        var layoutPt = this.node.getPosition();\n        var innerId;\n\n        //note that pt is the postion in canvas node.\n        var pt = clickPt;\n        var pt1 = {};\n\n        var magicCost = _parent.clickSele.magicCost;\n        var level = _parent.clickSele.level;\n        var role = _parent.clickSele.role;\n\n        if(role === undefined || role == \"\") {\n            return;\n        }  \n\n        var selCard = _parent.clickSele.params.target;\n        var selNode = _parent.clickSele.node;\n\n        var pl = selNode.parent.getPosition();  //sel card node.\n        var yOffset;\n\n        if(_parent.mainPlayer==1) {\n            yOffset=-20;\n        } else {\n            yOffset=40;\n        }\n\n        //pointer position\n        pt1.x = (layoutPt.x + pt.x - pl.x)-10;\n        pt1.y = (layoutPt.y + pt.y - pl.y)-(canvasPt.y + layoutPt.y);\n\n        //position in layout\n        pt.x = pt.x/_parent.node.scaleX - (canvasPt.x + layoutPt.x);\n        pt.y = pt.y/_parent.node.scaleY - (canvasPt.y + layoutPt.y) + yOffset;\n\n        if(!this.ifNotMaskRole(role)) {\n            this.showMask(this.maskType, 1);\n        }\n\n        if(!this.isValidPutPoint(pt) && !this.ifNotMaskRole(role)) {\n            console.log(\"invalid postion.\");\n            this.putErrorMsg();\n            return;\n        }\n\n        innerId = _parent.putClickItem(selCard, selNode, pt1);\n        _parent.sendSodier(magicCost, role, pt, innerId, level);\n    },\n\n    isValidPutPoint: function(point) {\n        var pt = {};\n        pt.x = point.x;\n        pt.y = point.y;\n        if(this.mainPlayer == 2) {\n            pt.y = point.y-40;\n        }\n\n        if(this.maskType == \"seleMask1\") {\n            if(pt.x >= 30 && pt.x <= 570 && pt.y > 0 && pt.y < 650) {\n                return true;\n            } else {\n                return false;\n            }\n        }\n        else if(this.maskType == \"seleMask12\") {\n            if((pt.x >= 30 && pt.x <= 570 && pt.y > 0 && pt.y < 420) || (pt.x >= 285 && pt.x <= 570 && pt.y > 420 && pt.y < 650)) {\n                return true;\n            } else {\n                return false;\n            }\n        }\n        else if(this.maskType == \"seleMask13\") {\n            if((pt.x >= 30 && pt.x <= 570 && pt.y > 0 && pt.y < 420) || (pt.x >= 30 && pt.x <= 285 && pt.y > 420 && pt.y < 650)) {\n                return true;\n            } else {\n                return false;\n            }\n        }\n        else if(this.maskType == \"seleMask3\") {\n            if(pt.x >= 30 && pt.x <= 570 && pt.y > 0 && pt.y < 420) {\n                return true;\n            } else {\n                return false;\n            }\n        }\n        return false;\n    },\n\n    ifNotMaskRole: function (role) {\n        if(role == \"bomb\" || role == \"thunder\"  || role == \"heal\") {\n            return true;\n        }\n        return false;\n    },\n\n    initEventListener:function () {\n        this.node.on(\"event_effect\", this.onEventEffect.bind(this));\n    },\n\n    onEventEffect:function() {\n        console.log(\"listening effect loaded....\");\n    },\n\n    setCountDown:function(counter) {\n        var min = parseInt(counter/60);\n        var sec = counter%60;\n        //console.log(min +\":\"+ sec);\n        var timeNode = this.canvasNode.getChildByName(\"banner\").getChildByName(\"time\");\n        var cdNode = timeNode.getChildByName(\"countDown\").getComponent(\"cc.Label\");\n        if(sec<10) {\n            sec = \"0\" + sec;\n        }\n        cdNode.string = (min +\":\"+ sec);\n    },\n\n    doubleMagicDisp:function() {\n        var dispnode = this.node.getChildByName(\"doubleMagic\");\n        dispnode.active = true;\n    },\n\n    setTimeCounter:function(cnt) {\n        //use to compare if timeout, only for pk mode.\n        this.gameNowTime = cnt;\n        this.setCountDown(cnt);\n        if(cnt == 60) {\n            console.log(\"magic charge speed up\");\n            this.doubleMagicDisp();\n            this.addJuice = 20;\n        }\n\n        this.setMagicBar();\n\n        //counter1.setSpriteFrame(cc.spriteFrameCache.getSpriteFrame(\"num_8.png\"));\n        //3 second is the ai page loading time.\n        var count_down = this.gameCycleTime-cnt;\n\n        if(count_down<0) {\n            this.gameOver=true;\n            return;\n        }\n\n        var tens = parseInt(count_down/10);\n        var ones = count_down%10;\n\n        //console.log(tens +\":::\"+ ones);\n    },\n\n    startTraceTimer:function() {\n        //refer to server interval setting, must a little shorter than that in server\n        this.interval = 30;\n        var then = Date.now();\n        var _parent = this;\n\n        // 30 mini seconds a game cycle.\n        var game_cycle = this.gameCycleTime*1000; \n        var game_cycle_then = Date.now();\n        var cycle_cnt = 0;\n\n        if(!this.traceTimer) {\n            this.traceTimer = function() {                \n                var now = Date.now();\n                var delta = now - then;\n\n                //when net traffic happened, idle for 5's will halt\n                //not tested yet.\n                var game_cycle_delta = now - _parent.gameStartTime;\n                // if within game cycle time\n                if(!_parent.gameOver && game_cycle_delta > cycle_cnt*1000) {\n                    cycle_cnt++;\n\n                    // if no response for 5s, then timeout\n                    if(Math.abs(cycle_cnt-_parent.gameNowTime) > 5) {\n                        this.syncTimeout();\n                    }\n                }\n\n                if(delta>_parent.interval) {\n                    then = now - (delta%_parent.interval);\n                    _parent.mainGameCycle();\n                }\n            }.bind(this);\n        }\n\n        this.schedule(this.traceTimer,0);\n    },\n\n    mainGameCycle:function() {\n        var _parent = this;\n        var data,agents,bullets,bases,forts,rollLogs,agentsFuture,fortsFuture;\n\n        if(this.gameTraceStack.length > this.bufferLen) {\n            this.gameTraceStack.shift();\n            data = this.gameTraceStack[0];\n            //data = this.gameTraceStack[this.gameTraceStack.length - 10];\n            agents = data.agents;\n            agentsFuture = this.gameTraceStack[29].agents;\n            fortsFuture = this.gameTraceStack[29].forts;\n            bullets = data.bullets;\n            bases = data.bases;\n            forts = data.forts;\n            rollLogs = data.rollLogs;\n\n            _parent.playBullets(bullets);\n            _parent.playLogs(rollLogs);\n\n            _parent.playAgents(agents, agentsFuture);\n            _parent.playBases(bases);\n            _parent.playForts(forts);\n\n            _parent.bulletProcess(bullets);\n            _parent.logProcess(rollLogs);\n            _parent.agentProcess(agents);\n            _parent.fortProcess(forts, fortsFuture);\n            _parent.baseProcess(bases);\n        }\n\n        //var event = new cc.Event.EventCustom(\"event_effect\", true);\n        //event.detail = \"123\";\n        //this.node.dispatchEvent(event);\n    },\n\n    syncTimeout:function() {\n        this.gameOver=true;\n        this.stopTraceTimer();\n        MY_SOCKET.disconnect();\n\n        console.log(\"网络断开\");\n        //this.goPrevious();                 \n    },\n\n    stopTraceTimer:function() {\n        if(this.traceTimer) {\n            this.unschedule(this.traceTimer);\n        }\n    },\n\n    playSnd:function(sndType) {\n        if(sndType == \"base\") {\n            cc.audioEngine.play(this.audios[0], false, 1);\n        }\n        else if(sndType == \"fireSend\") {\n            cc.audioEngine.play(this.audios[1], false, 1);\n        } \n        else if(sndType == \"bomb\") {\n            cc.audioEngine.play(this.audios[2], false, 1);\n        }\n        else if(sndType == \"ske\") {\n            cc.audioEngine.play(this.audios[3], false, 1);\n        }\n        else if(sndType == \"hr\") {\n            cc.audioEngine.play(this.audios[4], false, 1);\n        }\n        else if(sndType == \"lr\") {\n            cc.audioEngine.play(this.audios[5], false, 1);\n        }\n        else if(sndType == \"gi\") {\n            cc.audioEngine.play(this.audios[6], false, 1);\n        }  \n        else if(sndType == \"put1\") {\n            cc.audioEngine.play(this.audios[7], false, 1);\n        }  \n        else if(sndType == \"wizfire\") {\n            cc.audioEngine.play(this.audios[2], false, 1);\n        }  \n        else if(sndType == \"lm\") {\n            cc.audioEngine.play(this.audios[8], false, 1);\n        }  \n        else if(sndType == \"gun\") {\n            cc.audioEngine.play(this.audios[9], false, 1);\n        }  \n        else if(sndType == \"thunder\") {\n            cc.audioEngine.play(this.audios[10], false, 1);\n        }  \n        else if(sndType == \"heal\") {\n            cc.audioEngine.play(this.audios[11], false, 1);\n        } \n        else if(sndType == \"log\") {\n            cc.audioEngine.play(this.audios[12], false, 1);\n        } \n    },\n\n    playEffect: function(role, x, y) {\n        var bd;\n        //play effect.\n        //should destroy when finish.\n        if(role == \"hr\") {\n            bd = cc.instantiate(this.playerPrefab[13]);\n            bd.x = x;\n            bd.y = y+20;\n            this.node.addChild(bd);\n        }\n        if(role == \"lm\") {\n            this.playSnd(\"lm\");\n            bd = cc.instantiate(this.playerPrefab[15]);\n            bd.x = x;\n            bd.y = y-40;\n            this.node.addChild(bd);\n        }\n        else if(role == \"base\") {\n            this.playSnd(\"base\");\n            bd = cc.instantiate(this.playerPrefab[10]);\n            bd.x = x;\n            bd.y = y;\n            this.node.addChild(bd);\n        }\n        //fortA\n        else if(role == \"fa\") {\n            bd = cc.instantiate(this.playerPrefab[10]);\n            bd.x = x;\n            bd.y = y;\n            this.node.addChild(bd);\n        }\n        else if(role == \"log\") {\n            bd = cc.instantiate(this.playerPrefab[10]);\n            bd.scaleX = 0.8;\n            bd.scaleY = 0.8;\n            bd.x = x+10;\n            bd.y = y;\n            this.node.addChild(bd);\n        }\n        else if(role == \"bomb\") {\n            this.playSnd(\"bomb\");\n            //shake the screen\n            this.startSceneJitter();\n            bd = cc.instantiate(this.playerPrefab[6]);\n            bd.active = true;\n            bd.x = x;\n            bd.y = y;\n            this.node.addChild(bd);\n        }\n        else if(role == \"wizfire\") {\n            this.playSnd(\"wizfire\");\n            bd = cc.instantiate(this.playerPrefab[19]);\n            bd.active = true;\n            bd.x = x;\n            bd.y = y;\n            this.node.addChild(bd);\n        }\n    },\n\n});\n"]}