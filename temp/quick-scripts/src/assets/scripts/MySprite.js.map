{"version":3,"sources":["assets/scripts/MySprite.js"],"names":["common","require","agentObj","cc","Class","properties","sprAtlas","SpriteAtlas","wrapMode","WrapMode","Loop","routes","lastAct","lastAngle","life","eid","onLoad","layoutOp","node","parent","getComponent","start","ctor","init","posX","posY","now","Date","angle","groupKill","attacking","_animation","Animation","setInitPos","px","py","pt","v2","push","updatePos","moveTo","nx","ny","ap","getAnchorPoint","size","getContentSize","x","width","shadowMoveTo","setPosition","shadow","dispShadow","frameNo","shadowNode","frameImg","act","actTmp","split","actDir","actType","scaleX","lastScaleX","active","loader","loadRes","SpriteFrame","err","spriteFrame","_name","Sprite","e","console","log","getActnameByAngle","actName","ret","specialActname","role","specialAct","setId","aid","hide","setShadow","getAgentAngle","oPos","dPos","tanAngle","dx","dy","ox","oy","y","ifFlyAgent","playAngleAnimationNear","agent","agentFuture","isMainPlayer","startPos","mypos","enemyPos","enemypos","zorder","parseInt","randomTime","Math","ceil","random","fx","fy","vt","ag","targetPos","angleInfo","ex","ey","distance","sub","mag","attackDistance","zIndex","getAttackDistance","PI","atan","abs","blood","play","playAngleAnimationRemote","startEPos","targetEPos","vtE","_self","then","rot","stop","lastActType"],"mappings":"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","sourceRoot":"/","sourcesContent":["var common = require(\"Common\");\nvar agentObj = require(\"AgentObj\");\n\ncc.Class({\n    extends: agentObj,\n\n    properties: {\n        sprAtlas: cc.SpriteAtlas,\n        wrapMode: cc.WrapMode.Loop,\n        routes:[],\n        lastAct:\"\",\n        lastAngle:-1,\n        life:-1,\n        eid:-1,\n    },\n\n    onLoad () {\n        this.layoutOp = this.node.parent.getComponent(\"Game\");\n    },\n\n    start () {\n    },\n\n    ctor() {\n    },\n\n    init: function() {\n        this.posX = 0;\n        this.posY = 0;\n        this.now = Date.now();\n        this.angle = -999;\n        this.groupKill = false;\n        this.attacking = false;\n\n        this._animation = this.getComponent(cc.Animation);\n        this._animation.WrapMode = cc.WrapMode.Loop;\n        //this._animation.on(\"lastframe\", this.onend, this);\n    },\n\n/*    \n    setEnemy: function(enemyObj) {\n        if(enemyObj) {\n            this.eid = enemyObj.name;\n            this.enemy = enemyObj;            \n        } \n        else {\n            this.eid = \"\";\n            this.enemy = null;              \n        }\n    },\n\n    onend: function(event) {\n        var agentNode;\n        if(this.enemy.isValid) {\n            agentNode = this.enemy.getComponent('SkeSprite');\n            agentNode.remove();\n        } \n        //this.shootArrow(this.ox, this.oy, this.ex, this.ey, this.arrow);\n    },\n*/\n\n    setInitPos: function(px, py) {\n        this.posX = px;\n        this.posY = py;\n        var pt = cc.v2(this.posX, this.posY);\n\n        this.routes.push(pt);\n    },\n\n    updatePos: function(px, py) {\n        var moveTo = cc.v2(px, py);\n        var nx,ny;\n        var ap = this.node.getAnchorPoint();\n        var size = this.node.getContentSize();\n        \n        nx = (0.5-ap.x) * size.width + px;\n        //ny = (0.5-ap.y) * size.height + py;\n        ny = py;\n\n        var shadowMoveTo = cc.v2(nx, ny);\n        \n        this.node.setPosition(moveTo);\n\n        if(this.shadow) { \n            this.shadow.setPosition(moveTo);\n        }\n        return;\n    },\n\n/*\n    remove: function() {\n        //this.node.scaleX = 0.3;\n        //this.node.scaleY = 0.3;\n        \n        this._animation.play(\"dieoff2\");\n        this.shadow.destroy();\n\n        //node destory in sprite afterkill func\n        //this.node.destroy();\n    },\n*/\n\n    dispShadow: function(frameNo) {\n        //shadow object may not ready in init() when playing\n        if(!this.shadow) return;\n\n        var shadowNode = this.shadow;\n        var frameImg = \"ske_shadow/e/ske_walk_e\"+frameNo;\n        var act = this.lastAct;\n\n        if(!act) return;\n\n        var actTmp = this.lastAct.split(\"_\");\n\n        var actDir = actTmp[1];\n        var actType = actTmp[2];\n        var scaleX = this.lastScaleX;\n\n        if(actDir == \"en1\" || actDir == \"en2\" || actDir == \"en3\") {\n            frameImg = \"ske_shadow/en/ske_walk_en\"+frameNo;\n        }\n        else if(actDir == \"se1\" || actDir == \"se2\" || actDir == \"se3\") {\n            frameImg = \"ske_shadow/se/ske_walk_se\"+frameNo;\n        }\n        else if(actDir == \"s\") {\n            frameImg = \"ske_shadow/s/ske_walk_s\"+frameNo;\n        }\n        else if(actDir == \"n\") {\n            frameImg = \"ske_shadow/n/ske_walk_n\"+frameNo;\n        }\n        else if(actDir == \"e\") {\n            frameImg = \"ske_shadow/e/ske_walk_e\"+frameNo;\n        }\n\n        this.shadow.active = true;\n        cc.loader.loadRes(frameImg, cc.SpriteFrame, function (err, spriteFrame) {\n            if(shadowNode) {\n                try {\n                    if(shadowNode._name != \"\") {\n                        shadowNode.getComponent(cc.Sprite).spriteFrame = spriteFrame;\n                    }\n                } catch (e) {\n                    console.log(shadowNode);\n                    console.log(e);\n                }\n            }\n        });\n    },\n\n/*\n    move: function(pt) {\n        if(this.removeFlag) {\n            return;\n        }\n\n        var len = this.routes.length;\n        var moveTo;\n\n        if(len == 0) return;\n        if(len == 1) {\n            moveTo = this.routes[0];\n        } else {\n            moveTo = this.routes.shift();     \n        }\n\n        this.node.setPosition(moveTo);\n        if(this.shadow && this.shadow.isValid) {\n            this.shadow.setPosition(moveTo);     \n        }\n    },\n\n    setAction: function() {\n        var eastAnimFrames = [],\n            str = \"\",\n            frame,\n            animation;\n\n        for (var i = 1; i <= 4; i++) {        \n            str = \"c5u\" + i;\n            frame = this.sprAtlas.getSpriteFrame(str);\n            eastAnimFrames.push(frame);\n        }\n\n        //animation = new cc.Animation(eastAnimFrames);\n\n        var clip = cc.AnimationClip.createWithSpriteFrames(eastAnimFrames,frames.length);\n        clip.name = \"anim_001\";\n        clip.speed = 0.08;\n        clip.sample = 4;\n        clip.wrapMode = this.wrapMode;\n        this._animation.addClip(clip);\n    },\n\n    playAnimation: function (wrapMode = cc.WrapMode.Default, speed = 0.5, sample = 60) {\n        if(this._animation) {\n            var animState = this._animation.getAnimationState(\"anim_001\");\n            animState.clip.wrapMode = wrapMode;\n            animState.clip.speed = speed;\n            animState.clip.sample = sample;\n            animState.repeatCount = Infinity;\n            this._animation.play(\"anim_001\");\n        }\n    },\n\n    setInitAct: function(angle, actType) {\n        var angleInfo = this.getActnameByAngle(angle, actType);\n        this.lastAct = angleInfo.actName;\n    },\n\n    getActnameByAngle_bak: function(angle, actType) {\n        var actName=\"\";\n        var scaleX = 1;\n        var ret = {};\n\n        if(angle>=0 && angle<=11.25*1) {\n            if(actType == \"move\") {\n                actName = \"n_walk\";\n            }\n            else if(actType == \"sa\") {\n                actName = \"n_attack\";\n            }\n        }\n        else if(angle>11.25*1 && angle<=11.25*3) {\n            if(actType == \"move\") {\n                actName = \"en3_walk\";\n            }\n            else if(actType == \"sa\") {\n                actName = \"en3_attack\";\n            }\n        }\n        else if(angle>11.25*3 && angle<=11.25*5) {\n            if(actType == \"move\") {\n                actName = \"en2_walk\";\n            }\n            else if(actType == \"sa\") {\n                actName = \"en2_attack\";\n            }\n        }\n        else if(angle>11.25*5 && angle<=11.25*7) {\n            if(actType == \"move\") {\n                actName = \"en1_walk\";\n            }\n            else if(actType == \"sa\") {\n                actName = \"en1_attack\";\n            }\n        }\n        else if(angle>11.25*7 && angle<=11.25*9) {\n            if(actType == \"move\") {\n                actName = \"e_walk\";\n            }\n            else if(actType == \"sa\") {\n                actName = \"e_attack\";\n            }\n        }\n        else if(angle>11.25*9 && angle<=11.25*11) {\n            if(actType == \"move\") {\n                actName = \"se1_walk\";\n            }\n            else if(actType == \"sa\") {\n                actName = \"se1_attack\";\n            }\n        }\n        else if(angle>11.25*11 && angle<=11.25*13) {\n            if(actType == \"move\") {\n                actName = \"se2_walk\";\n            }\n            else if(actType == \"sa\") {\n                actName = \"se2_attack\";\n            }\n        }\n        else if(angle>11.25*13 && angle<=11.25*15) {\n            if(actType == \"move\") {\n                actName = \"se3_walk\";\n            }\n            else if(actType == \"sa\") {\n                actName = \"se3_attack\";\n            }\n        }\n        else if(angle>11.25*15 || angle<=180) {\n            if(actType == \"move\") {\n                actName = \"s_walk\";\n            }\n            else if(actType == \"sa\") {\n                actName = \"s_attack\";\n            }\n        }\n\n\n        else if(angle<0 && angle>=11.25*-1) {\n            if(actType == \"move\") {\n                actName = \"n_walk\";\n            }\n            else if(actType == \"sa\") {\n                actName = \"n_attack\";\n            }\n            //scaleX = -1;\n        }\n        else if(angle<11.25*-1 && angle>=11.25*-3) {\n            if(actType == \"move\") {\n                actName = \"en3_walk\";\n            }\n            else if(actType == \"sa\") {\n                actName = \"en3_attack\";\n            }\n            //scaleX = -1;\n        }\n        else if(angle<11.25*-3 && angle>=11.25*-5) {\n            if(actType == \"move\") {\n                actName = \"en2_walk\";\n            }\n            else if(actType == \"sa\") {\n                actName = \"en2_attack\";\n            }\n\n            //scaleX = -1;\n        }\n        else if(angle<11.25*-5 && angle>=11.25*-7) {\n            if(actType == \"move\") {\n                actName = \"en1_walk\";\n            }\n            else if(actType == \"sa\") {\n                actName = \"en1_attack\";\n            }\n\n            //scaleX = -1;\n        }\n        else if(angle<11.25*-7 && angle>=11.25*-9) {\n            if(actType == \"move\") {\n                actName = \"e_walk\";\n            }\n            else if(actType == \"sa\") {\n                actName = \"e_attack\";\n            }\n\n            scaleX = -1;\n        }\n        else if(angle<11.25*-9 && angle>=11.25*-11) {\n            if(actType == \"move\") {\n                actName = \"se1_walk\";\n            }\n            else if(actType == \"sa\") {\n                actName = \"se1_attack\";\n            }\n\n            scaleX = -1;\n        }\n        else if(angle<11.25*-11 && angle>=11.25*-13) {\n            if(actType == \"move\") {\n                actName = \"se2_walk\";\n            }\n            else if(actType == \"sa\") {\n                actName = \"se2_attack\";\n            }\n\n            scaleX = -1;\n        }\n        else if(angle<11.25*-13 && angle>=11.25*-15) {\n            if(actType == \"move\") {\n                actName = \"se3_walk\";\n            }\n            else if(actType == \"sa\") {\n                actName = \"se3_attack\";\n            }\n\n            scaleX = -1;\n        } \n        else if(angle<11.25*-15 && angle>-180) {\n            if(actType == \"move\") {\n                actName = \"s_walk\";\n            }\n            else if(actType == \"sa\") {\n                actName = \"s_attack\";\n            }\n\n            scaleX = -1;\n        }\n\n        else {\n            console.log(\"------:\"+angle);\n        }\n\n        actName = this.role +\"_\"+ actName;\n\n        ret.actName = actName;\n        ret.scaleX = scaleX;\n        return ret;\n    },\n*/\n\n    getActnameByAngle: function(angle, actType) {\n        var actName=\"\";\n        var scaleX = 1;\n        var ret = {};\n        var specialActname = false;\n\n        if(angle>22.5*-1 && angle<=22.5*1) {\n            if(actType == \"move\") {\n                actName = \"n_walk\";\n            }\n            else if(actType == \"sa\") {\n                actName = \"n_attack\";\n            }\n        }\n        else if(angle>22.5*1 && angle<=22.5*3) {\n            if(actType == \"move\") {\n                actName = \"en2_walk\";\n            }\n            else if(actType == \"sa\") {\n                actName = \"en2_attack\";\n            }\n        }\n        else if(angle>22.5*3 && angle<=22.5*5) {\n            if(actType == \"move\") {\n                actName = \"e_walk\";\n            }\n            else if(actType == \"sa\") {\n                actName = \"e_attack\";\n            }\n        }\n        else if(angle>22.5*5 && angle<=22.5*7) {\n            if(actType == \"move\") {\n                actName = \"se2_walk\";\n            }\n            else if(actType == \"sa\") {\n                actName = \"se2_attack\";\n            }\n        }\n        else if(angle>22.5*7 || angle<-22.5*9) {\n            if(actType == \"move\") {\n                actName = \"s_walk\";\n            }\n            else if(actType == \"sa\") {\n                actName = \"s_attack\";\n            }\n        }\n\n        else if(angle<22.5*-1 && angle>=22.5*-3) {\n            if(actType == \"move\") {\n                actName = \"en2_walk\";\n            }\n            else if(actType == \"sa\") {\n                actName = \"en2_attack\";\n            }\n\n            scaleX = -1;\n        }\n        else if(angle<22.5*-3 && angle>=22.5*-5) {\n            if(actType == \"move\") {\n                actName = \"e_walk\";\n            }\n            else if(actType == \"sa\") {\n                actName = \"e_attack\";\n            }\n\n            scaleX = -1;\n        }\n        else if(angle<22.5*-5 && angle>=22.5*-7) {\n            if(actType == \"move\") {\n                actName = \"se2_walk\";\n            }\n            else if(actType == \"sa\") {  // start attack\n                actName = \"se2_attack\";\n            }\n\n            scaleX = -1;\n        }\n        else if (angle<22.5*-7){\n            if(actType == \"move\") {\n                actName = \"s_walk\";\n            }\n            else if(actType == \"sa\") {   // start attack\n                actName = \"s_attack\";\n            }\n\n            scaleX = -1;\n        }\n        else {\n            console.log(\"----error angle--------------:\"+angle);\n        }\n\n        actName = this.role +\"_\"+ actName;\n \n        specialActname = this.specialAct(actType);\n        if(specialActname) {\n            actName = specialActname;\n        }\n\n        ret.actName = actName;\n        ret.scaleX = scaleX;\n        return ret;\n    },\n\n    specialAct: function(actType) {\n        // if just 1 vs 1 attack\n        if(!this.groupKill) {\n            return false;\n        }\n        if(actType == \"sa\" && this.role == \"hr\") {\n            return \"hr_all_kill\";\n        }\n        return false;\n    },\n\n    setId: function(aid) {\n        this.aid = aid;\n\n        //var event = new cc.Event.EventCustom(\"event_effect\", true);\n        //event.detail = \"123\";\n        //this.node.dispatchEvent(event);\n    },\n\n    hide: function() {\n        this.node.active = false;\n    },\n\n    setShadow: function(shadow) {\n        this.shadow = shadow;\n        this.shadow.active = true;\n    },\n\n    getAgentAngle: function(oPos, dPos, tanAngle) {\n        var dx,dy,ox,oy;\n        var angle;\n\n        dx = dPos.x;\n        dy = dPos.y;\n        ox = oPos.x;\n        oy = oPos.y;\n\n        if(dx-ox>0 && dy-oy>0) {\n            angle = tanAngle;\n        }\n        else if(dx-ox>0 && dy-oy<0) {\n            angle = 180-tanAngle;\n        }\n        else if(dx-ox<0 && dy-oy<0) {\n            angle = 180+tanAngle;\n        }\n        else if(dx-ox<0 && dy-oy>0) {\n            angle = 0-tanAngle;\n        }\n        else if(dx-ox==0 && dy-oy>0) {\n            angle = 0;\n        }\n        else if(dx-ox==0 && dy-oy<0) {\n            angle = 180;\n        }\n        else if(dy-oy==0 && dx-ox>0) {\n            angle = 90;\n        }\n        else if(dy-oy==0 && dx-ox<0) {\n            angle = -90;\n        } else {\n            console.log(\"wrong angle in Func MySprite->getAgentAngle()\");\n        }\n\n        return angle;\n    },\n\n    ifFlyAgent: function(role) {\n        if(role == \"bee\") {\n            return true;\n        }\n        return false;\n    },\n\n    playAngleAnimationNear: function(agent, agentFuture, isMainPlayer) {\n        if(this.attacking) {\n            return;\n        }\n\n        var startPos = cc.v2(agent.mypos.x, agent.mypos.y);\n        var enemyPos = cc.v2(agent.enemypos.x, agent.enemypos.y);\n        var zorder = 1000+parseInt(32-agent.mypos.y);\n        var randomTime = Math.ceil(Math.random()*125)/100;\n        var actName = \"\";\n        var actType = agent.actType;\n        var fx,fy,vt,ag=0,targetPos,angleInfo;\n\n        var x = agent.mypos.x;\n        var y = agent.mypos.y;\n        var ex = agent.enemypos.x;\n        var ey = agent.enemypos.y;\n\n        var distance = startPos.sub(enemyPos).mag();\n        var attackDistance;\n\n        // fly agent should hover over any other agent.\n        if(!this.ifFlyAgent(agent.role)) {\n            this.node.zIndex = zorder;\n        }\n        this.node.scaleX = 1;\n        \n        if(this._animation) {\n            attackDistance = this.getAttackDistance(agent);\n\n            //1.5 is the distance ajustment variable, should be ajust according to each agent size.\n            //attackDistance = (agent.size + agent.esize)*0.5*1.5;\n\n            if(distance<=attackDistance) {\n                // dir according to enemy position\n                startPos  = cc.v2(x, y);\n                targetPos = cc.v2(ex, ey);\n                vt = targetPos.sub(startPos);\n\n                //if dir no changed, vt.x or vt.y is 0, atan value should be invaild\n                if(vt.x == 0) {\n                    vt.x = 0.1;\n                }\n                if(vt.y == 0) {\n                    vt.y = 0.1;\n                }\n\n                if(vt.x != 0 && vt.y != 0) {\n                    ag = 180/Math.PI * Math.atan(Math.abs(vt.x/vt.y));\n                } \n                ag = this.getAgentAngle(agent.mypos, {\"x\":ex, \"y\":ey}, ag);\n                if(ag > 180) {\n                    ag = ag - 360;\n                }\n\n                angleInfo = this.getActnameByAngle(ag, \"sa\");\n                actName = angleInfo.actName;\n                //used to mirror a sprite.\n                this.node.scaleX = angleInfo.scaleX;\n\n            } else {\n\n                if(agentFuture) {\n                    fx = agentFuture.enemypos.x; \n                    fy = agentFuture.enemypos.y;\n                } else {\n                    fx = agent.enemypos.x;\n                    fy = agent.enemypos.y;\n                }\n                startPos  = cc.v2(x, y);\n                targetPos = cc.v2(fx, fy);\n                vt = targetPos.sub(startPos);\n\n                //if dir no changed, vt.x or vt.y is 0, atan value should be invaild\n                if(vt.x == 0) {\n                    vt.x = 0.1;\n                }\n                if(vt.y == 0) {\n                    vt.y = 0.1;\n                }\n\n                if(vt.x != 0 && vt.y != 0) {\n                    ag = 180/Math.PI * Math.atan(Math.abs(vt.x/vt.y));\n                }\n\n                ag = this.getAgentAngle(agent.mypos, {\"x\":fx, \"y\":fy}, ag);\n                if(ag > 180) {\n                    ag = ag - 360;\n                }\n\n                angleInfo = this.getActnameByAngle(ag, \"move\");\n                actName = angleInfo.actName;\n\n                //used to mirror a sprite.\n                this.node.scaleX = angleInfo.scaleX;\n            }\n\n            //blood bar may flip when agent flip, should make it back.\n            this.blood.scaleX = this.node.scaleX;\n\n            if(this.lastAct != actName) {\n                if(distance<=attackDistance) {\n                    this._animation.play(actName);\n                    //if(this.playEffect !== undefined) {\n                    //    this.playEffect();\n                    //}\n                } else if(!this.attacking) {\n                    this._animation.play(actName, randomTime);\n                }\n                this.lastAct = actName;\n                this.lastScaleX = angleInfo.scaleX;\n            }\n        }\n    },\n\n    playAngleAnimationRemote: function(agent, agentFuture, isMainPlayer) {\n        var fx,fy,actType;\n        var ag = 0;\n        var x = agent.mypos.x; \n        var y = agent.mypos.y; \n        var ex = agent.enemypos.x; \n        var ey = agent.enemypos.y; \n\n        var startPos,targetPos,startEPos, targetEPos, vt, vtE;\n        var _self = this;\n        var zorder = 1000+parseInt(32-y);\n\n        //total animator duration is 1.25s, so take a random time from 0-1.25 to prevent same action\n        var randomTime = Math.ceil(Math.random()*125)/100;\n        var actName = \"\";\n        var then;\n        var angleInfo;\n\n        actType = agent.actType;\n        if(actType == \"ia\" || actType == \"ea\" ) { \n            return;\n        }\n\n        ag = agent.rot;\n        this.node.zIndex = zorder;\n        this.node.scaleX = 1;\n\n        if(actType == \"sa\") {  //start attack\n            // dir according to enemy position\n            startPos  = cc.v2((x)*30, (y)*30);\n            targetPos = cc.v2((ex)*30, (ey)*30);\n            vt = targetPos.sub(startPos);\n\n            //if dir no changed, vt.x or vt.y is 0, atan value should be invaild\n            if(vt.x == 0) {\n                vt.x = 0.1;\n            }\n            if(vt.y == 0) {\n                vt.y = 0.1;\n            }\n\n            if(vt.x != 0 && vt.y != 0) {\n                //ag = 180/Math.PI * Math.atan(Math.abs(vt.y/vt.x));\n                ag = 180/Math.PI * Math.atan(Math.abs(vt.x/vt.y));\n                ag = this.getAgentAngle(agent.mypos, {\"x\":ex, \"y\":ey}, ag);\n            } \n        } \n\n        if(actType == \"move\") {\n            if(agentFuture) {\n                fx = agentFuture.enemypos.x; \n                fy = agentFuture.enemypos.y;\n                //future acttype maybe ia instead of move or sa, in this case should not be handled.\n                if(agentFuture && agentFuture.actType != \"ia\") {\n                    actType = agentFuture.actType;\n                } \n            } else {\n                fx = agent.enemypos.x;\n                fy = agent.enemypos.y;\n                if(agentFuture && agentFuture.actType != \"ia\") {\n                    actType = agentFuture.actType;\n                }\n            }\n            startPos  = cc.v2((x)*30, (y)*30);\n            targetPos = cc.v2((fx)*30, (fy)*30);\n            vt = targetPos.sub(startPos);\n\n            //if dir no changed, vt.x or vt.y is 0, atan value should be invaild\n            if(vt.x == 0) {\n                vt.x = 0.1;\n            }\n            if(vt.y == 0) {\n                vt.y = 0.1;\n            }\n\n            if(vt.x != 0 && vt.y != 0) {\n                ag = 180/Math.PI * Math.atan(Math.abs(vt.x/vt.y));\n                ag = this.getAgentAngle(agent.mypos, {\"x\":fx, \"y\":fy}, ag);\n            } \n        }\n\n        if(this._animation) {\n            angleInfo = this.getActnameByAngle(ag, actType);\n            actName = angleInfo.actName;\n\n            //used to mirror a sprite.\n            this.node.scaleX = angleInfo.scaleX;\n\n            //blood bar may flip when agent flip, should make it back.\n            this.blood.scaleX = this.node.scaleX;\n\n            //if already in attack mode, just skip the animation\n            if(this.lastAct != actName || actType == \"sa\") {\n                if(actType == \"sa\") {\n                    this._animation.stop();\n                    this._animation.play(actName);\n                } else {\n                    //walking action.\n                    this._animation.play(actName, randomTime);\n                }\n                this.lastAct = actName;\n                this.lastScaleX = angleInfo.scaleX;\n            }\n        }\n\n/*\n        if(this._animation) {\n            angleInfo = this.getActnameByAngle(angle, actType);\n            actName = angleInfo.actName;\n            this.node.scaleX = angleInfo.scaleX;\n\n            //if already in attack mode, just skip the animation\n            if(this.lastAct != actName) {\n                then = Date.now();\n                // to avoid changing dir frequently. agent would looks tremble otherwise.\n                if(then - this.now > 100) {\n                    this._animation.play(actName, randomTime);\n                    this.angle = angle;\n                    this.now = then;\n                }\n            }\n\n            //if(this.lastAct != actName && actType==\"sa\") {\n            //    var _self = this;\n            //    var animState = this._animation.getAnimationState(actName);\n            //    if (animState) {\n            //        animState.on('lastframe', (event) => {}, this);\n            //    }\n            //}\n\n            this.lastAct = actName;\n\n            this.lastScaleX = angleInfo.scaleX;\n        }\n*/\n\n        this.lastActType = actType;\n    }\n\n    // update (dt) {},\n});\n"]}